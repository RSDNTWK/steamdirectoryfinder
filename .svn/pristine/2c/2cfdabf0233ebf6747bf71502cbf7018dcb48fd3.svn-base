using System;
using System.IO;
using System.Net;
using System.Windows.Forms;
using steamdirectoryfinder.Properties;

namespace steamdirectoryfinder
{
    public partial class ServerConfiguration : Form
    {
        public static string ServerInstallPath;

        public ServerConfiguration(String path)
        {
            InitializeComponent();
            ServerInstallPath = path;
        } 

        public static void DownloadSteamcmd()
        {
            using (var client = new WebClient())
            {
                client.DownloadFile("http://media.steampowered.com/installer/steamcmd.zip", "steamcmd.zip");
                client.DownloadFile("http://www.gsptalk.com/mirror/sourcemod/mmsource-1.10.4-windows.zip",
                    "mmsource.zip");
                client.DownloadFile("http://www.gsptalk.com/mirror/sourcemod/sourcemod-1.7.1-windows.zip",
                    "sourcemod.zip");
            }
        }

        public static void CheckifDirectoryexistsorcreateit(String fun)
        {
            Directory.CreateDirectory(fun);
        }
        public static void ExtractServerResources()
        {
            File.WriteAllBytes("7za.exe", Resources._7za);
            Program.Performtasks("7za.exe", "x steamcmd.zip -o " + Program.PutIntoQuotes(Directory.GetParent(ServerInstallPath).FullName));
            //Performtasks("7za.exe","x mmsource.zip -o "+ fun);
            //Performtasks("7za.exe", "x sourcemod.zip -o " + fun);
        }

        private void button2_Click(object sender, EventArgs e)
        {
            CheckifDirectoryexistsorcreateit(ServerInstallPath);
            DownloadSteamcmd();
            ExtractServerResources();
            Program.InstallServer(textBox1.Text, textBox2.Text,
                Directory.GetParent(ServerInstallPath).FullName);
        }
    }
}